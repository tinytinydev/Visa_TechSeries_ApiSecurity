# X-PAY-TOKEN Authentication
X-PAY-TOKEN authentication is one of the authentication mechanism for Visa Developer APIs. This authentication uses an API and Shared Secret for authentication. More details can be found [here](https://developer.visa.com/pages/working-with-visa-apis/x-pay-token)

## Server
The server (Producer) exposes API(s) that can be called by a client (Consumer). In this example the server expose a API for Push Payment (/payment/push).

## Client
The client has to provide their API Key in the query along with a X-PAY-TOKEN in the Http Headers.

A X-PAY-TOKEN is generated by:

1. Generating a message string by concatenating the following parameters:
   ```
   message = timestamp + resource_path + query_string + request_body
   ```

2. Create the token as shown below:
   ```
   XPayToken = "xv2:" + timestamp + ":" + SHA256HMAC(shared_secret, message)
   ``` 
   SHA256 HMAC is a type of message authentication code used to verify the integrity and authenticity of a message. It uses a hash function and a secret key to generate a Hash-based Message Authentication Code (HMAC).
   This method allows use to verify that a request is coming from an expected source and the request has not been tampered while in transit.

## Objective
Implement X-Pay-Token Authentication to ensure that only authenticated users can call the API successfully. The message will also be hashed using HMAC with a Secret Key to help us verify that the message is from a expected source and has not been tampered with.

Modify Line 36 to 39 in Server/app.js & Modify Line 20 to 22 in Client/app.js to implement Hashed Message that will be used in X-Pay-Token.

Upon successful implementation, these messages will be displayed accordingly

### Server/app.js
```
    Expected from Client: f36b60e5bbf59e4fbda465b0c37ad9d5b679ee610eae9ecc099c0c97fd6ae6f3
    Received from Client: f36b60e5bbf59e4fbda465b0c37ad9d5b679ee610eae9ecc099c0c97fd6ae6f3

    ===== XPayToken Authentication Success ! =====
```
### Client/app.js
```
    Generated Pre Hash Message: 1633219200/payment/pushapikey=VmlzYUBTbXVUZWNoU2VyaWVzMjAyMQ=={"from":"bankA","to":"bankB"}
    Generated X-Pay-Token: xv2:1633219200:f36b60e5bbf59e4fbda465b0c37ad9d5b679ee610eae9ecc099c0c97fd6ae6f3

    ===== XPayToken Authentication Success ! =====
    Response Status Code:  200
    Server Host Name: server.visa.io
```
## Testing the Code
Run app.js on both Server and Client folder to see the output.

You can also run the startup script to test the output: 

Start the shell script (startup.sh) on a Mac machine using this command
```
    ./start.sh
```

Start the powershell script (startup.ps1) on a Windows machine using this command
```
    powershell .\startup.ps1
```
Enter XPayToken when prompted for which project to start.
